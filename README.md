# Xome-Blender
Xome-Blender is a collection of bash, R and C++ scripts based on SAMtools, GATK, Picard and VcfTools functions that allows to generate synthetic cancer genomes with user defined features such as the number of subclones, the number of somatic variants and the presence of CNV, without the addition of any synthetic element. It is composed of two modules: InXalizer and Xome-Blender. The first module is devoted to the blending process initialization. It takes as input a single BAM file, a set of user-defined parameters and returns the coverage of the sample and the input-files for the second module (Xome-Blender). Optionally, it creates a file containing the coordinates to insert CNV in the final product.
The second module generates the synthetic heterogeneous sample.
###### Supported on Linux and Mac OS X.

## Requirements 
* R (https://www.r-project.org)
* SAMtools 1.1 or above (http://www.htslib.org/download/)
* GATK 3.3 or above (https://www.broadinstitute.org/gatk/)
* VcfTools (https://sourceforge.net/projects/vcftools/)
* Picard (https://broadinstitute.github.io/picard/)

## Installation

### Clone the Xome-Blender repository
    
    git clone git://github.com/rsemeraro/Xome-Blender.git
    
### Compile

The project can be compiled by calling make in the top-level directory:    
    
    make
## Usage
First run InXalizer. It requires a BAM file, a label for it and a reference genome. By means of four parameters it is possible to tune the initialization process: 
 * Subclone number = the number of subclones that will compose the final product (```-scn```).
 * Variants number = the number of somatic variants that will appear in the final product (```-vn```).
 * Subclonal architecture = the evolution model for the sample synthesis, it can be Linear or Branched (```-sa```).
 * CNV = it's an option that allows for the generation of a CNV file, defining their number and length (```-c```).

Otionally, it is possible to use a target file, in bed format, to edit only defined portions of the BAM file (whole-exome or target sequencing experiments).

Examples:
* Running InXalizer with minimum requirements:

        InXalizer -f file.bam -l my_label -r MyRef.fasta -scn 2 -vn 50 -sa Branched
        
* Running InXalizer with target file:

        InXalizer -f file.bam -l my_label -r MyRef.fasta -scn 2 -vn 50 -sa Branched -b MyTargetfile.bed

* Running InXalizer with CNVs:

        InXalizer -f file.bam -l my_label -r MyRef.fasta -scn 2 -vn 50 -sa Branched -c 3,1000000

InXalizer can be run to generate CNV files only, by using the "CNV list" function, invoked as ```-cl```.

        InXalizer.sh -r ref.fa -cl cnv_list.txt
        
Each line of the cnv_list file must contain a label for the cnv file to be generated, the number and the size of CNV events and, optionally, the path to a target file.

The data generated by InXalizer are then used to configure the Xome-Blender analysis.
The main module takes as input the BAM files, their ID, the coverages previously calculated, the percentage of each BAM in order to create the mixed sample, the desired coverage of the output file and the variant file generated in the previous step. <br /> It can be run in **single mode** by typing all the options in a shell, as in the example below.

        Xome-Blender -f file1,file2,file3 -i Id1,Id2,Id3 -c 127,138,90 -p 30,40,30 -tc 130 -v My-favorite-label.vcf
  \*Multiple elements must be comma separated. <br />
  \**The order of samples must be respected in each option!
  
  Alternatively, it can be run in **automated mode** by using the ```--list (-l)``` option. The activation of this parameter requires a list file, by assigning this it's possible to run multiple consecutive analyses.

      Xome-Blender -l list_file.txt
   The list_file is a tab separated file containing different anlayses (one per row). Each row must contain all the options above.
  ##### List_file example
      NA18501.bam,NA12889.bam	NA18501,NA12889	145,193	20,80	200
      NA18501.bam,NA12889.bam	NA18501,NA12889	145,193	30,70	150
      NA18501.bam,NA12889.bam	NA18501,NA12889	145,193	40,60	100
      NA18501.bam,NA12889.bam	NA18501,NA12889	145,193	50,50	180 

## Contacts

This program has been developed by Roberto Semeraro, Department of Experimental and Clinical Medicine, University of Florence
